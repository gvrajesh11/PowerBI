SELECT  B.SITE, 
        C.REPORTING_CUST_NAME, 
        D.ITEM_NUMBER,
        A.ORDERED_ITEM,
        'Open Orders' AS Type,
        SUM(ORDERED_QTY) 
FROM "ITGR_DL"."VIZ"."W_F_OPEN_SALES_ORDERS_ENT_V" AS A
LEFT JOIN "ITGR_DL"."VIZ"."W_D_INVENTORY_ORGANIZATION_V" AS B ON A.ORGANIZATION_ID = B.ORGANIZATION_ID
LEFT JOIN "ITGR_DL"."VIZ"."W_D_CUSTOMER_V" AS C ON A.BILL_TO_ID = C.BILL_TO_ID AND A.SOURCE_SYS_ID = C.SOURCE_SYS_ID AND A.CUSTOMER_ID = C.CUSTOMER_ID
                                                AND A.SHIP_TO_ID = C.SHIP_TO_ID
LEFT JOIN "ITGR_DL"."VIZ"."W_D_PRODUCT_V" AS D ON A.SOURCE_SYS_ID = D.SOURCE_SYS_ID AND A.INVENTORY_ITEM_ID = D.INVENTORY_ITEM_ID                                                
WHERE YEAR(A.SHIP_DATE_CALC) = 2022
GROUP BY B.SITE, C.REPORTING_CUST_NAME, D.ITEM_NUMBER, A.ORDERED_ITEM
UNION
SELECT  B.SITE, 
        C.REPORTING_CUST_NAME, 
        D.ITEM_NUMBER,
        A.CUSTOMER_ITEM_NO,
        'Shipments' AS Type,
        SUM(SHIP_QTY) 
FROM "ITGR_DL"."VIZ"."W_F_AR_TRANSACTIONS_V" AS A
LEFT JOIN "ITGR_DL"."VIZ"."W_D_INVENTORY_ORGANIZATION_V" AS B ON A.ORGANIZATION_ID = B.ORGANIZATION_ID
LEFT JOIN "ITGR_DL"."VIZ"."W_D_CUSTOMER_V" AS C ON A.BILL_TO_ID = C.BILL_TO_ID AND A.SOURCE_SYS_ID = C.SOURCE_SYS_ID AND A.CUSTOMER_ID = C.CUSTOMER_ID
                                                AND A.SHIP_TO_ID = C.SHIP_TO_ID
LEFT JOIN "ITGR_DL"."VIZ"."W_D_PRODUCT_V" AS D ON A.SOURCE_SYS_ID = D.SOURCE_SYS_ID AND A.INVENTORY_ITEM_ID = D.INVENTORY_ITEM_ID                                                
WHERE YEAR(A.TRX_DATE) = 2022
GROUP BY B.SITE, C.REPORTING_CUST_NAME, D.ITEM_NUMBER, A.CUSTOMER_ITEM_NO
 